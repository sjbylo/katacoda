# Topic 1

# Example of how to allow containers to run as root or any specific user ID.

To allow containers to run as root (or any user) in OpenShift a policy needs to be set on the _service account_ your pod is running under. 
We will use the _default service account of the project_.

Take a look at the Dockerfile we will be using:

``clear; cat build-root/Dockerfile``{{execute}}

The Dockerfile simply builds an image, copies a file into the image and when the image is launched it starts a long running process ``sleep 999999`` and does nothing.

First we will see what happens if we try to run a container as root on OpenShift.

Before we get started, you need to login and create a project in OpenShift
to work in.

To login to the OpenShift cluster used for this course from the _Terminal_,
run:

``oc login -u developer -p developer``{{execute}}

This will log you in using the credentials:

* **Username:** ``developer``
* **Password:** ``developer``

You should see the output:

```
Login successful.

You don't have any projects. You can try to create a new project, by running

    oc new-project <projectname>
```

To create a new project called ``myproject`` run the command:

``oc new-project myproject``{{execute}}

You should see output similar to:

```
Now using project "myproject" on server "https://172.17.0.41:8443".
...
```

# Show that containers running on OpenShift cannot run as root (by default).

Build a new example container in OpenShift using the above example Dockerfile. 
Note that the Dockerfile contains "**USER 0**", i.e. the container should run as root.

Create new build configuration:

``oc new-build --name mypod --binary``{{execute}}

Start the buiuld and view the output:

``oc start-build mypod --from-dir=build-root --follow --wait``{{execute}}

Launch the container:

``oc new-app mypod``{{execute}}

``oc get po``

``POD_ID=$(oc get pods | grep mypod.*Running | awk '{print $1}' | tail -1); echo $POD_ID``{{execute}}

Exec into the container and you will see it is running as non-root (not 0).

``oc exec $POD_ID id``{{execute}}

You can see that the container is running as uid=1000050000 (or similar).  It is not running as root because OpenShift does not allow containers to run as root by default. 

Remote shell into the pod and see who owns the file:

``oc rsh $POD_ID``{{execute}}
``ls -l /tmp/somefile``{{execute}}
``ps -ef``{{execute}}

Exit from the container:

``exit``{{execute}}

As you can see, the file belongs to root, but the process is not running as root (UID!=0). Not that when creating container images using Dockerfiles, commands can run as root to do things like install packages and files as root.

Next we'll try the same with plain Docker.

